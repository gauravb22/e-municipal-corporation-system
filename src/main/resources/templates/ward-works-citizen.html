<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Your Ward Works</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <link rel="stylesheet" href="/css/ward-works-citizen.css">
</head>
<body>
<div class="topbar">
    <div class="brand">
        <img src="/images/municipalLogo.png" alt="Logo">
        <div>
            <div style="font-weight:700;">Akola Mahanagarpalika</div>
            <div style="font-size:12px;opacity:.85;">Your Ward Works</div>
        </div>
    </div>
    <a href="/dashboard" style="color:#0f2f22;text-decoration:none;font-weight:600;">Back</a>
</div>

<div class="container">
    <div class="filter-bar">
        <div>
            <div class="filter-label">Filter</div>
            <select class="filter-select" id="filterAll">
                <option value="all">All Posts</option>
            </select>
        </div>
        <div>
            <div class="filter-label">Ward No</div>
            <select class="filter-select" id="filterWard">
                <option value="all">All Wards</option>
            </select>
        </div>
        <div>
            <div class="filter-label">Zone</div>
            <select class="filter-select" id="filterZone">
                <option value="all">All Zones</option>
            </select>
        </div>
    </div>

    <div class="feed">
        <div class="post" th:each="p : ${posts}" th:attr="data-ward=${p.wardNo},data-zone=${p.wardZone}">
            <div class="post-header">
                <img class="profile" th:src="${postPhotos[p.id] != null ? postPhotos[p.id] : '/images/ward-member.png'}" alt="Ward Member">
                <div>
                    <div class="name" th:text="${postOwnerNames[p.id] != null ? postOwnerNames[p.id] : 'Ward Member'}">Ward Member</div>
                    <div class="meta">Ward <span th:text="${p.wardNo}">-</span> • Zone <span th:text="${p.wardZone}">-</span> • <span th:text="${p.createdAt != null ? #temporals.format(p.createdAt, 'dd-MMM-yyyy HH:mm') : 'N/A'}">--</span></div>
                </div>
            </div>

            <img class="post-img" th:if="${p.imageBase64 != null}" th:src="${p.imageBase64}" alt="Work photo">
            <div class="post-body">
                <div class="post-title" th:text="${p.title}">Title</div>
                <div class="meta" th:text="${p.address}">Address</div>
                <div class="post-text" th:text="${p.description}">Description</div>
                <div class="meta" style="margin-top:8px;">Work Done: <span th:text="${p.workDoneDate != null ? p.workDoneDate : 'N/A'}">--</span></div>
            </div>

            <div class="actions">
                <form method="post" th:action="'/ward-works/' + ${p.id} + '/like'">
                    <button class="icon-btn" type="submit"
                            th:classappend="${userLiked[p.id]} ? ' disabled' : ''"
                            th:disabled="${userLiked[p.id]}">
                        <i class="fa-heart icon-heart" th:classappend="${userLiked[p.id]} ? ' fa-solid liked' : ' fa-regular'"></i>
                    </button>
                </form>
                <span class="icon-count" th:text="${likeCounts[p.id]} ?: 0">0</span>
                <div class="meta">Avg <span th:text="${avgRatings[p.id]} ?: 0.0">0.0</span>/5</div>
            </div>

            <div class="rating">
                <form method="post" th:action="'/ward-works/' + ${p.id} + '/rate'" th:id="'rateForm-' + ${p.id}">
                    <input type="hidden" name="rating" th:id="'rating-' + ${p.id}" value="0">
                    <span class="star" th:attr="data-work=${p.id}" data-value="1"><i class="fa-solid fa-star" aria-hidden="true"></i></span>
                    <span class="star" th:attr="data-work=${p.id}" data-value="2"><i class="fa-solid fa-star" aria-hidden="true"></i></span>
                    <span class="star" th:attr="data-work=${p.id}" data-value="3"><i class="fa-solid fa-star" aria-hidden="true"></i></span>
                    <span class="star" th:attr="data-work=${p.id}" data-value="4"><i class="fa-solid fa-star" aria-hidden="true"></i></span>
                    <span class="star" th:attr="data-work=${p.id}" data-value="5"><i class="fa-solid fa-star" aria-hidden="true"></i></span>
                </form>
            </div>

            <div class="comment-box">
                <form method="post" th:action="'/ward-works/' + ${p.id} + '/comment'" class="comment-form">
                    <input class="comment-input" type="text" name="comment" placeholder="Write a comment..." required>
                    <button class="comment-btn" type="submit">Post</button>
                </form>
            </div>

            <div class="comment" th:each="c : ${commentsMap[p.id]}" th:if="${commentsMap[p.id] != null}">
                <div class="who" th:text="${c.name}">Citizen</div>
                <div th:text="${c.text}">Comment</div>
                <div class="meta" th:text="${#temporals.format(c.createdAt, 'dd-MMM-yyyy HH:mm')}"></div>
            </div>
        </div>
    </div>
</div>


    <script src="/js/ward-works-citizen.js"></script>
</body>
</html>

