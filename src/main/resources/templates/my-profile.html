<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>E-Municipal Corporation | My Profile</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
:root{
    --bg1:#0f2027;
    --bg2:#203a43;
    --bg3:#2c5364;
    --accent:#1e3c72;
    --accent-2:#2a5298;
    --card:#ffffffee;
    --text:#1b1f24;
}
*{box-sizing:border-box;}
body{
    margin:0;
    font-family:"Segoe UI", Arial;
    background:
      radial-gradient(circle at top left, #2a5298, transparent 40%),
      radial-gradient(circle at bottom right, #1e3c72, transparent 40%),
      linear-gradient(135deg,var(--bg1),var(--bg2),var(--bg3));
    min-height:100vh;
    color:var(--text);
}

/* Top bar */
.topbar{
    background:#0f2442;
    color:white;
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:14px 18px;
}
.topbar-left{display:flex;align-items:center;gap:12px;}
.topbar img{width:44px;}
.menu-btn{font-size:22px;cursor:pointer;}

/* Sidebar */
.sidebar{
    position:fixed;
    top:0;
    left:-260px;
    width:260px;
    height:100%;
    background:white;
    box-shadow:4px 0 20px rgba(0,0,0,.3);
    transition:.3s;
    z-index:100;
}
.sidebar.open{left:0;}
.sidebar h3{margin:0;padding:16px;background:var(--accent);color:white;}
.sidebar a{display:block;padding:14px 18px;text-decoration:none;color:#333;border-bottom:1px solid #eee;}
.sidebar a i{margin-right:10px;}
.sidebar a:hover{background:#f2f2f2;}
.logout{color:#c0392b;font-weight:600;}
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;}
.overlay.show{display:block;}

/* Page */
.container{
    max-width:760px;
    margin:22px auto 60px;
    padding:10px;
}
.page-title{
    color:white;
    font-weight:600;
    margin:16px 0 12px;
}
.card{
    background:var(--card);
    border-radius:18px;
    padding:22px;
    margin-bottom:16px;
    box-shadow:0 15px 35px rgba(0,0,0,.25);
    backdrop-filter:blur(6px);
}
.section-title{
    display:flex;
    align-items:center;
    gap:10px;
    color:var(--accent);
    margin:0 0 12px;
    font-size:18px;
}
.form-grid{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:14px;
}
.label{font-size:13px;color:#5a5f66;margin-bottom:6px;display:block;}
.input{
    width:100%;
    padding:10px 12px;
    border-radius:10px;
    border:1px solid #d9dee5;
    font-size:14px;
    outline:none;
    background:white;
}
.input:focus{border-color:var(--accent-2);box-shadow:0 0 0 3px rgba(42,82,152,.15);}
.full{grid-column:1 / -1;}

.actions{
    display:flex;
    flex-wrap:wrap;
    gap:10px;
}
.profile-photo-wrap{
    display:flex;
    align-items:center;
    gap:14px;
    margin-bottom:18px;
}
.profile-photo{
    width:88px;
    height:88px;
    border-radius:50%;
    object-fit:cover;
    border:3px solid #d9e4f5;
    background:#fff;
}
.photo-upload{
    display:flex;
    flex-direction:column;
    gap:8px;
}
.photo-help{
    font-size:12px;
    color:#5a5f66;
}
.btn{
    border:none;
    border-radius:12px;
    padding:12px 16px;
    font-weight:600;
    cursor:pointer;
}
.btn-primary{background:linear-gradient(135deg,var(--accent),var(--accent-2));color:white;}
.btn-ghost{background:#eef2f7;color:#0f2442;}
.note{
    font-size:12px;
    color:#5a5f66;
    margin-top:6px;
}

@media (max-width:720px){
    .form-grid{grid-template-columns:1fr;}
}
</style>
</head>
<body>

<!-- SIDEBAR -->
<div class="sidebar" id="sidebar">
    <h3>Menu</h3>
    <a href="/my-profile"><i class="fa-solid fa-user"></i>My Profile</a>
    <a href="/raise-complaint"><i class="fa-solid fa-file-circle-plus"></i>Raise Complaint</a>
    <a href="/complaint-status"><i class="fa-solid fa-chart-line"></i>Complaint Status</a>
    <a href="/works-yojna"><i class="fa-solid fa-city"></i>Works / Yojna</a>
    <a href="/ward-works"><i class="fa-solid fa-person-digging"></i>Your Ward Works</a>
    <a href="/logout" class="logout"><i class="fa-solid fa-right-from-bracket"></i>Logout</a>
</div>
<div class="overlay" id="overlay" onclick="toggleMenu()"></div>

<!-- TOP BAR -->
<div class="topbar">
    <div class="topbar-left">
        <img src="/images/municipalLogo.png" alt="Logo">
        <div>
            <strong>E-Municipal Corporation</strong><br>
            <small>Akola Mahanagarpalika</small>
        </div>
    </div>
    <div class="menu-btn" onclick="toggleMenu()">
        <i class="fa-solid fa-bars"></i>
    </div>
</div>

<div class="container">
    <h2 class="page-title">My Profile</h2>

    <form class="card" action="/update-profile" method="post"><div th:if="${success}" class="alert alert-success" th:text="${success}"></div><div th:if="${error}" class="alert alert-error" th:text="${error}"></div>
        <div class="profile-photo-wrap">
            <img id="profilePhotoPreview"
                 class="profile-photo"
                 th:src="${user.photoBase64 != null && !#strings.isEmpty(user.photoBase64) ? (#strings.startsWith(user.photoBase64, 'data:') ? user.photoBase64 : ('data:image/jpeg;base64,' + user.photoBase64)) : '/images/municipalLogo.png'}"
                 alt="Profile photo">
            <div class="photo-upload">
                <label class="label" for="profilePhotoInput">Profile Photo</label>
                <input class="input" id="profilePhotoInput" type="file" accept=".jpg,.jpeg,image/jpeg" onchange="handleProfilePhoto(event)">
                <input id="photoBase64" name="photoBase64" type="hidden">
                <span class="photo-help">Only JPG format is allowed.</span>
            </div>
        </div>

        <h3 class="section-title"><i class="fa-solid fa-id-card"></i>Personal Details</h3>
        <div class="form-grid">
            <div>
                <label class="label" for="fullName">Full Name</label>
                <input class="input" id="fullName" name="fullName" type="text" placeholder="Enter your name" th:value="${user.fullName}">
            </div>
            <div>
                <label class="label" for="phone">Mobile Number</label>
                <input class="input" id="phone" name="phone" type="tel" placeholder="Enter mobile number" th:value="${user.phone}" readonly>
            </div>
            <div class="full">
                <label class="label" for="email">Email</label>
                <input class="input" id="email" name="email" type="email" placeholder="Enter email" th:value="${user.email}" readonly>
            </div>
        </div>

        <h3 class="section-title" style="margin-top:20px;"><i class="fa-solid fa-location-dot"></i>Address Details</h3>
        <div class="form-grid">
            <div>
                <label class="label" for="houseNo">House No.</label>
                <input class="input" id="houseNo" name="houseNo" type="text" placeholder="House number" th:value="${user.houseNo}">
            </div>
            <div>
                <label class="label" for="wardNo">Ward No.</label>
                <input class="input" id="wardNo" name="wardNo" type="text" placeholder="Ward number" th:value="${user.wardNo}">
            </div>
            <div>
                <label class="label" for="wardZone">Ward Zone</label>
                <input class="input" id="wardZone" name="wardZone" type="text" placeholder="Zone name" th:value="${user.wardZone}">
            </div>
            <div class="full">
                <label class="label" for="address">Full Address</label>
                <input class="input" id="address" name="address" type="text" placeholder="Street, area, landmark" th:value="${user.address}">
            </div>
        </div>

        <h3 class="section-title" style="margin-top:20px;"><i class="fa-solid fa-lock"></i>Password</h3>
        <div class="form-grid">
            <div>
                <label class="label" for="currentPassword">Current Password</label>
                <input class="input" id="currentPassword" name="currentPassword" type="password" placeholder="Current password">
            </div>
            <div>
                <label class="label" for="newPassword">New Password</label>
                <input class="input" id="newPassword" name="newPassword" type="password" placeholder="New password">
            </div>
            <div>
                <label class="label" for="confirmPassword">Confirm New Password</label>
                <input class="input" id="confirmPassword" name="confirmPassword" type="password" placeholder="Confirm password">
            </div>
        </div>
        <p class="note">Use a strong password with at least 8 characters.</p>

        <div class="actions" style="margin-top:16px;">
            <button class="btn btn-primary" type="submit">Save Changes</button>
            <button class="btn btn-ghost" type="reset">Reset</button>
        </div>
    </form>
</div>

<script>
function toggleMenu(){
    sidebar.classList.toggle("open");
    overlay.classList.toggle("show");
}

function isJpgFile(file){
    const type = (file.type || '').toLowerCase();
    const name = (file.name || '').toLowerCase();
    return type === 'image/jpeg' || type === 'image/jpg' || name.endsWith('.jpg') || name.endsWith('.jpeg');
}

function handleProfilePhoto(event){
    const file = event.target.files[0];
    if (!file) return;

    const hidden = document.getElementById('photoBase64');
    const preview = document.getElementById('profilePhotoPreview');

    if (!isJpgFile(file)) {
        if (hidden) hidden.value = '';
        event.target.value = '';
        alert('Only JPG format is allowed for profile photo.');
        return;
    }

    const reader = new FileReader();
    reader.onload = function(e){
        if (preview) preview.src = e.target.result;
        if (hidden) hidden.value = e.target.result;
    };
    reader.readAsDataURL(file);
}
</script>

</body>
</html>
