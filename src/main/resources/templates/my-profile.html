<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>E-Municipal Corporation | My Profile</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <link rel="stylesheet" href="/css/my-profile.css">
</head>
<body>

<!-- SIDEBAR -->
<div class="sidebar" id="sidebar">
    <h3>Menu</h3>
    <a href="/my-profile"><i class="fa-solid fa-user"></i>My Profile</a>
    <a href="/raise-complaint"><i class="fa-solid fa-file-circle-plus"></i>Raise Complaint</a>
    <a href="/complaint-status"><i class="fa-solid fa-chart-line"></i>Complaint Status</a>
    <a href="/works-yojna"><i class="fa-solid fa-city"></i>Works / Yojna</a>
    <a href="/ward-works"><i class="fa-solid fa-person-digging"></i>Your Ward Works</a>
    <a href="/logout" class="logout"><i class="fa-solid fa-right-from-bracket"></i>Logout</a>
</div>
<div class="overlay" id="overlay" onclick="toggleMenu()"></div>

<!-- TOP BAR -->
<div class="topbar">
    <div class="topbar-left">
        <img src="/images/municipalLogo.png" alt="Logo">
        <div>
            <strong>E-Municipal Corporation</strong><br>
            <small>Akola Mahanagarpalika</small>
        </div>
    </div>
    <div class="menu-btn" onclick="toggleMenu()">
        <i class="fa-solid fa-bars"></i>
    </div>
</div>

<div class="container">
    <h2 class="page-title">My Profile</h2>

    <form class="card" action="/update-profile" method="post"><div th:if="${success}" class="alert alert-success" th:text="${success}"></div><div th:if="${error}" class="alert alert-error" th:text="${error}"></div>
        <div class="profile-photo-wrap">
            <img id="profilePhotoPreview"
                 class="profile-photo"
                 th:src="${user.photoBase64 != null && !#strings.isEmpty(user.photoBase64) ? (#strings.startsWith(user.photoBase64, 'data:') ? user.photoBase64 : ('data:image/jpeg;base64,' + user.photoBase64)) : '/images/municipalLogo.png'}"
                 alt="Profile photo">
            <div class="photo-upload">
                <label class="label" for="profilePhotoInput">Profile Photo</label>
                <input class="input" id="profilePhotoInput" type="file" accept=".jpg,.jpeg,image/jpeg" onchange="handleProfilePhoto(event)">
                <input id="photoBase64" name="photoBase64" type="hidden">
                <span class="photo-help">Only JPG format is allowed.</span>
            </div>
        </div>

        <h3 class="section-title"><i class="fa-solid fa-id-card"></i>Personal Details</h3>
        <div class="form-grid">
            <div>
                <label class="label" for="fullName">Full Name</label>
                <input class="input" id="fullName" name="fullName" type="text" placeholder="Enter your name" th:value="${user.fullName}">
            </div>
            <div>
                <label class="label" for="phone">Mobile Number</label>
                <input class="input" id="phone" name="phone" type="tel" placeholder="Enter mobile number" th:value="${user.phone != null && !#strings.isEmpty(user.phone) ? '+91 ' + user.phone : ''}" readonly>
            </div>
            <div class="full">
                <label class="label" for="email">Email</label>
                <input class="input" id="email" name="email" type="email" placeholder="Enter email" th:value="${user.email}" readonly>
            </div>
        </div>

        <h3 class="section-title" style="margin-top:20px;"><i class="fa-solid fa-location-dot"></i>Address Details</h3>
        <div class="form-grid">
            <div>
                <label class="label" for="houseNo">House No.</label>
                <input class="input" id="houseNo" name="houseNo" type="text" placeholder="House number" th:value="${user.houseNo}">
            </div>
            <div>
                <label class="label" for="wardNo">Ward No.</label>
                <input class="input" id="wardNo" name="wardNo" type="text" placeholder="Ward number" th:value="${user.wardNo}">
            </div>
            <div>
                <label class="label" for="wardZone">Ward Zone</label>
                <input class="input" id="wardZone" name="wardZone" type="text" placeholder="Zone name" th:value="${user.wardZone}">
            </div>
            <div class="full">
                <label class="label" for="address">Full Address</label>
                <input class="input" id="address" name="address" type="text" placeholder="Street, area, landmark" th:value="${user.address}">
            </div>
        </div>

        <h3 class="section-title" style="margin-top:20px;"><i class="fa-solid fa-lock"></i>Password</h3>
        <div class="form-grid">
            <div>
                <label class="label" for="newPassword">New Password</label>
                <input class="input" id="newPassword" name="newPassword" type="password" placeholder="New password">
            </div>
            <div>
                <label class="label" for="confirmPassword">Confirm New Password</label>
                <input class="input" id="confirmPassword" name="confirmPassword" type="password" placeholder="Confirm password">
            </div>
            <div>
                <label class="label" for="passwordOtp">OTP</label>
                <input class="input" id="passwordOtp" name="passwordOtp" type="text" maxlength="6" inputmode="numeric" pattern="[0-9]{6}" placeholder="Enter 6-digit OTP">
            </div>
        </div>
        <div class="actions" style="margin-top:10px;">
            <button class="btn btn-ghost" type="button" onclick="sendPasswordOtp()">Send OTP</button>
            <span class="note" id="passwordOtpStatus"></span>
        </div>
        <p class="note">Use a strong password with at least 8 characters.</p>

        <div class="actions" style="margin-top:16px;">
            <button class="btn btn-primary" type="submit">Save Changes</button>
            <button class="btn btn-ghost" type="reset">Reset</button>
        </div>
    </form>
</div>



    <script src="/js/my-profile.js"></script>
</body>
</html>

