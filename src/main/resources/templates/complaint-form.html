<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Complaint Form | e-Municipal Corporation</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">


    <link rel="stylesheet" href="/css/complaint-form.css">
</head>

<body th:attr="data-requires-photo=${requiresPhoto}">
<div class="page-shell">
    <div class="topbar">
        <div class="topbar-title">
            <span class="icon"><i class="fa-solid fa-file-circle-plus" aria-hidden="true"></i></span>
            <span>Raise Complaint</span>
        </div>
        <a class="back-link" href="/raise-complaint">
            <i class="fa-solid fa-arrow-left" aria-hidden="true"></i>
            Back to Complaint Types
        </a>
    </div>

    <div class="form-card">
        <div class="complaint-type">
            <div class="label">Complaint Type</div>
            <div class="value" th:text="${complaintType}">Complaint Type</div>
        </div>

        <div class="error-banner" th:if="${error != null}" th:text="${error}">
            Validation error
        </div>

        <div class="section-title">Citizen Details</div>
        <div class="user-info">
            <div class="user-info-item">
                Name
                <strong th:text="${user.fullName}">Citizen Name</strong>
            </div>
            <div class="user-info-item">
                Phone
                <strong th:text="${user.phone != null && !#strings.isEmpty(user.phone) ? '+91 ' + user.phone : 'Phone'}">Phone</strong>
            </div>
            <div class="user-info-item">
                Ward Number
                <strong th:text="${user.wardNo != null ? user.wardNo : 'N/A'}">Ward</strong>
            </div>
            <div class="user-info-item">
                Ward Zone
                <strong th:text="${user.wardZone != null ? user.wardZone : 'N/A'}">Zone</strong>
            </div>
        </div>

        <form action="/submit-complaint" method="POST">
            <input type="hidden" name="type" th:value="${complaintType}">

            <div class="section-title">Complaint Details</div>
            <div class="form-grid">
                <div class="form-group full">
                    <label>
                        Location / Area <span class="required">*</span>
                        <span class="hint">Where exactly is the issue?</span>
                    </label>
                    <input type="text" name="location" placeholder="Enter area or landmark" th:value="${user.address}" required>
                </div>

                <div class="form-group">
                    <label>House Number <span class="required">*</span></label>
                    <input type="text" name="houseNo" placeholder="House number or building name" th:value="${user.houseNo}" required>
                </div>

                <div class="form-group">
                    <label>Ward Number <span class="required">*</span></label>
                    <input type="number" name="wardNo" placeholder="Ward number" th:value="${user.wardNo}" min="1" required>
                </div>

                <div class="form-group">
                    <label>Ward Zone <span class="required">*</span></label>
                    <input type="text" name="wardZone" placeholder="Zone code, e.g. A1" th:value="${user.wardZone}" required>
                </div>

                <div class="form-group full">
                    <label>
                        Detailed Description
                        <span class="hint">Add useful details, timing, and impact. (Optional)</span>
                    </label>
                    <textarea name="description" placeholder="Describe the complaint in detail"></textarea>
                </div>
            </div>

            <div class="date-section" th:if="${requiresNotComingDate}">
                <div class="capture-title">Not Coming From Date</div>
                <div class="form-group" style="margin-bottom: 0;">
                    <label>Select Date <span class="required">*</span></label>
                    <input type="date" name="notComingFromDate" th:value="${param.notComingFromDate}" required>
                </div>
                <p>Photo upload is not required for this complaint type.</p>
            </div>

            <div class="camera-section" th:if="${requiresPhoto}">
                <div class="capture-title">Complaint Photo <span class="required">*</span></div>
                <p class="capture-note">
                    Capture a live photo from camera. Timestamp and current location are attached automatically.
                    Only JPG format is accepted.
                </p>

                <div class="timestamp-info">
                    <i class="fa-regular fa-clock" aria-hidden="true"></i>
                    <strong> Timestamp:</strong>
                    <span id="timestampDisplay">--:--:--</span>
                </div>

                <div class="location-info">
                    <i class="fa-solid fa-location-dot" aria-hidden="true"></i>
                    <strong> Location:</strong>
                    <span id="locationDisplay">Fetching GPS...</span>
                </div>

                <button type="button" class="camera-button" onclick="capturePhoto()">
                    <i class="fa-solid fa-camera" aria-hidden="true"></i>
                    Capture Photo from Camera
                </button>

                <img id="photoPreview" class="camera-preview" alt="Captured photo preview">
                <div class="photo-captured" id="photoCapturedMsg">
                    <i class="fa-solid fa-circle-check" aria-hidden="true"></i>
                    Photo captured successfully.
                </div>

                <input type="file" id="photoInput" accept=".jpg,.jpeg,image/jpeg" capture="environment" onchange="handlePhotoCapture(event)">
                <input type="hidden" id="photoTimestamp" name="photoTimestamp">
                <input type="hidden" id="photoLocation" name="photoLocation">
                <input type="hidden" id="photoLatitude" name="photoLatitude">
                <input type="hidden" id="photoLongitude" name="photoLongitude">
                <input type="hidden" id="photoBase64" name="photoBase64">
            </div>

            <div class="button-group">
                <button type="button" class="btn btn-cancel" onclick="history.back()">
                    <i class="fa-solid fa-xmark" aria-hidden="true"></i>
                    Cancel
                </button>
                <button type="submit" class="btn btn-submit">
                    <i class="fa-solid fa-paper-plane" aria-hidden="true"></i>
                    Submit Complaint
                </button>
            </div>
        </form>
    </div>
</div>


    <script src="/js/complaint-form.js"></script>
</body>
</html>

