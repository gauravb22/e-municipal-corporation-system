<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>E-Municipal Corporation | Dashboard</title>

<!-- Font Awesome Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>

/* ================= GLOBAL ================= */
body{
    margin:0;
    font-family:"Segoe UI", Arial;
    background:
      radial-gradient(circle at top left, #2a5298, transparent 40%),
      radial-gradient(circle at bottom right, #1e3c72, transparent 40%),
      linear-gradient(135deg,#0f2027,#203a43,#2c5364);
    min-height:100vh;
}

/* ================= TOP BAR ================= */
.topbar{
    background:#0f2442;
    color:white;
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:14px 18px;
}
.topbar-left{
    display:flex;
    align-items:center;
    gap:12px;
}
.topbar img{ width:44px; }
.topbar-right{
    display:flex;
    align-items:center;
    gap:12px;
    position:relative;
}
.menu-btn{
    font-size:22px;
    cursor:pointer;
}
.notification-wrap{
    position:relative;
}
.bell-btn{
    border:none;
    background:rgba(255,255,255,0.12);
    color:white;
    width:38px;
    height:38px;
    border-radius:50%;
    cursor:pointer;
    position:relative;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:18px;
}
.bell-btn:hover{
    background:rgba(255,255,255,0.22);
}
.notif-badge{
    position:absolute;
    top:-5px;
    right:-6px;
    min-width:18px;
    height:18px;
    border-radius:999px;
    background:#e74c3c;
    color:white;
    font-size:10px;
    font-weight:700;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:0 5px;
}
.notif-panel{
    position:absolute;
    right:0;
    top:46px;
    width:320px;
    max-height:380px;
    background:white;
    border-radius:14px;
    box-shadow:0 14px 34px rgba(0,0,0,.28);
    overflow:hidden;
    display:none;
    z-index:210;
}
.notif-panel.show{
    display:block;
}
.notif-head{
    background:#f5f8ff;
    color:#1e3c72;
    padding:10px 12px;
    border-bottom:1px solid #e6ebf5;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:8px;
    font-weight:700;
}
.notif-markall{
    border:none;
    background:transparent;
    color:#1e3c72;
    font-size:11px;
    font-weight:700;
    cursor:pointer;
    padding:0;
}
.notif-markall:hover{
    text-decoration:underline;
}
.notif-list{
    max-height:320px;
    overflow-y:auto;
}
.notif-item{
    display:block;
    text-decoration:none;
    color:#1e2a3a;
    border-bottom:1px solid #edf1f8;
    padding:10px 12px;
}
.notif-item:last-child{
    border-bottom:none;
}
.notif-item.unread{
    background:#eef4ff;
}
.notif-title{
    font-size:13px;
    font-weight:700;
}
.notif-msg{
    margin-top:4px;
    font-size:12px;
    color:#49566a;
}
.notif-time{
    margin-top:6px;
    font-size:11px;
    color:#7b8796;
}
.notif-empty{
    padding:14px 12px;
    color:#6b7788;
    font-size:12px;
}

/* ================= RUNNING ALERT ================= */
.alert-bar{
    background:linear-gradient(90deg,#f39c12,#f1c40f);
    padding:12px 0;
    overflow:hidden;
    white-space:nowrap;
    box-shadow:0 4px 12px rgba(0,0,0,.25);
}
.alert-text{
    display:inline-block;
    padding-left:100%;
    font-weight:600;
    font-size:14px;
    animation:scroll 18s linear infinite;
}
.alert-text span{ margin-right:60px; }
@keyframes scroll{
    from{transform:translateX(0);}
    to{transform:translateX(-100%);}
}

/* ================= SIDEBAR ================= */
.sidebar{
    position:fixed;
    top:0;
    left:-260px;
    width:260px;
    height:100%;
    background:white;
    box-shadow:4px 0 20px rgba(0,0,0,.3);
    transition:.3s;
    z-index:100;
}
.sidebar.open{ left:0; }
.sidebar h3{
    margin:0;
    padding:16px;
    background:#1e3c72;
    color:white;
}
.sidebar a{
    display:block;
    padding:14px 18px;
    text-decoration:none;
    color:#333;
    border-bottom:1px solid #eee;
}
.sidebar a i{ margin-right:10px; }
.sidebar a:hover{ background:#f2f2f2; }
.logout{ color:#c0392b; font-weight:600; }

/* Overlay */
.overlay{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.45);
    display:none;
}
.overlay.show{ display:block; }

/* ================= CONTENT ================= */
.container{
    max-width:560px;
    margin:22px auto;
    padding:10px;
}

/* Section title */
.section-title{
    color:white;
    margin:16px 0 10px;
    font-weight:600;
}

/* ================= CARDS ================= */
.card{
    background:rgba(255,255,255,0.92);
    border-radius:18px;
    padding:20px;
    margin-bottom:16px;
    box-shadow:0 15px 35px rgba(0,0,0,.25);
    backdrop-filter:blur(6px);
}

/* ================= ACTION GRID ================= */
.grid{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:16px;
}
.action-card{
    cursor:pointer;
    position:relative;
    overflow:hidden;
    transition:.35s ease;
}
.action-card::after{
    content:"";
    position:absolute;
    top:0;
    left:-100%;
    width:100%;
    height:100%;
    background:linear-gradient(120deg,transparent,rgba(30,60,114,.15),transparent);
    transition:.5s;
}
.action-card:hover::after{ left:100%; }
.action-card:hover{
    transform:translateY(-8px) scale(1.03);
}

/* Icon box */
.icon-box{
    width:48px;
    height:48px;
    display:flex;
    align-items:center;
    justify-content:center;
    border-radius:12px;
    background:linear-gradient(135deg,#1e3c72,#2a5298);
    color:white;
    font-size:22px;
    margin-bottom:10px;
}

/* ================= NOTICE ================= */
.notice{
    border-left:6px solid #c0392b;
}

/* ================= OFFICIALS ================= */
.admin-slider{
    position:relative;
    text-align:center;
    padding:8px 4px 4px;
}
.admin-title{
    font-weight:700;
    color:#1e3c72;
    font-size:18px;
    margin-bottom:6px;
}
.admin-name{
    font-weight:700;
    color:#0f2442;
    font-size:16px;
}
.admin-desc{
    color:#5c6674;
    font-size:13px;
    margin:6px 0 10px;
}
.admin-photo{
    width:86px;
    height:86px;
    border-radius:50%;
    border:3px solid #1e3c72;
    object-fit:cover;
    background:white;
    margin:0 auto;
    display:block;
}
.admin-slide-indicator{
    margin-top:10px;
    font-size:12px;
    color:#7a8796;
}

/* ================= FOOTER ================= */
.footer{
    background:linear-gradient(135deg,#0b1f36,#132f4c);
    color:#dcdcdc;
    margin-top:40px;
    padding-top:24px;
}
.footer-container{
    max-width:900px;
    margin:auto;
    display:flex;
    flex-wrap:wrap;
    gap:24px;
    padding:0 16px;
}
.footer-section{
    flex:1;
    min-width:220px;
}
.footer-section h4{
    margin-bottom:10px;
    color:white;
}
.footer-section p{
    margin:4px 0;
    font-size:14px;
}
.footer-bottom{
    text-align:center;
    padding:12px;
    font-size:13px;
    border-top:1px solid rgba(255,255,255,.1);
    margin-top:12px;
}

/* ================= TOAST ================= */
.toast{
    position:fixed;
    top:18px;
    right:18px;
    background:linear-gradient(135deg,#0f9d58,#0b8043);
    color:white;
    padding:14px 18px;
    border-radius:12px;
    box-shadow:0 10px 24px rgba(0,0,0,.3);
    z-index:1000;
    font-weight:600;
    opacity:0;
    transform:translateY(-10px);
    animation:toast-in .35s ease forwards;
}
.toast small{
    display:block;
    font-weight:400;
    margin-top:4px;
    opacity:.9;
}
@keyframes toast-in{
    to{opacity:1; transform:translateY(0);}
}
@keyframes toast-out{
    to{opacity:0; transform:translateY(-10px);}
}

@media (max-width: 640px){
    .notif-panel{
        width:min(92vw, 320px);
        right:-6px;
    }
}

</style>
</head>

<body>

<!-- SIDEBAR -->
<div class="sidebar" id="sidebar">
    <h3>Menu</h3>
    <a href="/my-profile"><i class="fa-solid fa-user"></i>My Profile</a>
    <a href="/raise-complaint"><i class="fa-solid fa-file-circle-plus"></i>Raise Complaint</a>
    <a href="/complaint-status"><i class="fa-solid fa-chart-line"></i>Complaint Status</a>
    <a href="/works-yojna"><i class="fa-solid fa-city"></i>Works / Yojna</a>
    <a href="/citizen/ward-works"><i class="fa-solid fa-person-digging"></i>Your Ward Works</a>
    <a href="/logout" class="logout"><i class="fa-solid fa-right-from-bracket"></i>Logout</a>
</div>
<div class="overlay" id="overlay" onclick="toggleMenu()"></div>

<!-- TOP BAR -->
<div class="topbar">
    <div class="topbar-left">
        <img src="/images/municipalLogo.png" alt="Logo">
        <div>
            <strong>E-Municipal Corporation</strong><br>
            <small>Akola Mahanagarpalika</small>
        </div>
    </div>
    <div class="topbar-right">
        <div class="notification-wrap">
            <button type="button" class="bell-btn" id="notifBell" onclick="toggleNotifications(event)">
                <i class="fa-regular fa-bell"></i>
                <span class="notif-badge"
                      th:if="${unreadNotificationCount != null && unreadNotificationCount > 0}"
                      th:text="${unreadNotificationCount > 99 ? '99+' : unreadNotificationCount}">1</span>
            </button>
            <div class="notif-panel" id="notifPanel">
                <div class="notif-head">
                    <span>Notifications</span>
                    <form method="post"
                          action="/citizen/notifications/read-all"
                          th:if="${recentNotifications != null && !recentNotifications.isEmpty()}">
                        <input type="hidden" name="redirect" value="/dashboard">
                        <button type="submit" class="notif-markall">Mark all read</button>
                    </form>
                </div>
                <div class="notif-list" th:if="${recentNotifications != null && !recentNotifications.isEmpty()}">
                    <a class="notif-item"
                       th:each="n : ${recentNotifications}"
                       th:classappend="${n.readFlag != null && !n.readFlag} ? ' unread' : ''"
                       th:href="@{/citizen/notifications/{id}/open(id=${n.id})}">
                        <div class="notif-title" th:text="${n.title}">Notification</div>
                        <div class="notif-msg" th:text="${n.message}">Message</div>
                        <div class="notif-time"
                             th:text="${n.createdAt != null ? #temporals.format(n.createdAt, 'dd-MMM-yyyy HH:mm') : ''}">Time</div>
                    </a>
                </div>
                <div class="notif-empty" th:if="${recentNotifications == null || recentNotifications.isEmpty()}">
                    No notifications yet.
                </div>
            </div>
        </div>
        <div class="menu-btn" onclick="toggleMenu()">
            <i class="fa-solid fa-bars"></i>
        </div>
    </div>
</div>

<!-- ALERT -->
<div class="alert-bar">
    <div class="alert-text" id="alerts">
        <span th:if="${citizenNotices != null && !citizenNotices.isEmpty()}" th:each="n : ${citizenNotices}" th:text="${n.message}"></span>
        <span th:if="${citizenNotices == null || citizenNotices.isEmpty()}">No new notices from administration.</span>
    </div>
</div>

<div class="toast" id="complaintToast" th:if="${complaintSubmitted}">
    Complaint submitted
    <small>We have received your complaint.</small>
</div>

<!-- CONTENT -->
<div class="container">

    <div class="section-title">Citizen Services</div>

    <div class="grid">
        <a href="/raise-complaint" style="text-decoration:none; color:inherit;">
            <div class="card action-card">
             <div class="icon-box"><i class="fa-solid fa-pen-to-square"></i></div>
                <h3>Raise Complaint</h3>
                <p>Submit civic issues online</p>
            </div>
        </a>

       <a href="/complaint-status" style="text-decoration:none;color:inherit;">
            <div class="card action-card">
                <div class="icon-box">
                    <i class="fa-solid fa-magnifying-glass-chart"></i>
                </div>
                <h3>Complaint Status</h3>
                <p>Track complaint progress</p>
            </div>
        </a>

        <a href="/my-profile" style="text-decoration:none;color:inherit;">
            <div class="card action-card">
                <div class="icon-box"><i class="fa-solid fa-id-card"></i></div>
                <h3>My Profile</h3>
                <p>View or update details</p>
            </div>
        </a>

        <a href="/works-yojna" style="text-decoration:none;color:inherit;">
            <div class="card action-card">
                <div class="icon-box"><i class="fa-solid fa-road"></i></div>
                <h3>Works / Yojana</h3>
                <p>Municipal projects</p>
            </div>
        </a>
    </div>

    <div class="section-title">Important Notices</div>

    <div class="card notice">
        <ul th:if="${citizenNotices != null && !citizenNotices.isEmpty()}">
            <li th:each="n : ${citizenNotices}" th:text="${n.message}"></li>
        </ul>
        <ul th:if="${citizenNotices == null || citizenNotices.isEmpty()}">
            <li>No notices available right now.</li>
        </ul>
    </div>

    <div class="section-title">Pending Feedback</div>

    <div class="card" th:if="${pendingFeedback != null && !pendingFeedback.isEmpty()}">
        <p style="margin:0 0 10px;color:#1e3c72;font-weight:600;">
            Please submit feedback for completed complaints.
        </p>
        <div th:each="c : ${pendingFeedback}" style="padding:10px;border:1px solid #e7e7e7;border-radius:12px;margin-bottom:10px;">
            <div style="font-weight:700;color:#0f2442;" th:text="${c.complaintType}">Complaint Type</div>
            <div style="color:#5c6674;font-size:13px;margin-top:4px;">
                Completed on
                <span th:text="${c.updatedAt != null ? #temporals.format(c.updatedAt, 'dd-MMM-yyyy HH:mm') : #temporals.format(c.createdAt, 'dd-MMM-yyyy HH:mm')}"></span>
            </div>
            <a href="/complaint-status" style="display:inline-block;margin-top:8px;background:#1e3c72;color:white;text-decoration:none;padding:8px 12px;border-radius:10px;font-size:12px;font-weight:600;">
                Submit Feedback
            </a>
        </div>
    </div>
    <div class="card" th:if="${pendingFeedback == null || pendingFeedback.isEmpty()}">
        <p style="margin:0;color:#5c6674;">No pending feedback. Thank you for your response.</p>
    </div>

    <div class="section-title">Municipal Administration</div>

    <div class="card">
        <div class="admin-slider" id="adminSlider">
            <div class="admin-title" id="adminRole">Municipal Commissioner</div>
            <div class="admin-name" id="adminName">Shri __________</div>
            <div class="admin-desc" id="adminDesc">City administration and civic service oversight.</div>
            <img class="admin-photo" id="adminPhoto" src="images/commissioner.jpg" alt="Municipal Commissioner">
            <div class="admin-slide-indicator" id="adminIndicator">1 / 3</div>
        </div>
    </div>

</div>

<!-- FOOTER -->
<footer class="footer">
    <div class="footer-container">
        <div class="footer-section">
            <h4>E-Municipal Corporation</h4>
            <p>Akola Mahanagarpalika</p>
            <p>Digital governance for transparent civic services</p>
        </div>
        <div class="footer-section">
            <h4>Contact</h4>
            <p>Helpline: 1800-XXX-XXXX</p>
            <p>Email: support@akolamc.gov.in</p>
        </div>
        <div class="footer-section">
            <h4>Office Address</h4>
            <p>Akola Municipal Corporation</p>
            <p>Near Collector Office, Akola, Maharashtra</p>
        </div>
    </div>
    <div class="footer-bottom">
        Â© 2026 Akola Municipal Corporation | Developed by Gaurav Bulbule
    </div>
</footer>

<script>
const sidebar = document.getElementById("sidebar");
const overlay = document.getElementById("overlay");
const notifBell = document.getElementById("notifBell");
const notifPanel = document.getElementById("notifPanel");

function toggleMenu(){
    sidebar.classList.toggle("open");
    overlay.classList.toggle("show");
}

function toggleNotifications(event){
    if (event) {
        event.stopPropagation();
    }
    if (!notifPanel) {
        return;
    }
    notifPanel.classList.toggle("show");
}

document.addEventListener("click", function (event) {
    if (!notifPanel || !notifBell) {
        return;
    }
    if (notifPanel.contains(event.target) || notifBell.contains(event.target)) {
        return;
    }
    notifPanel.classList.remove("show");
});


const adminSlides = [
    {
        role: "Municipal Commissioner",
        name: "Shri Ajitji Pawar",
        desc: "City administration and civic service oversight.",
        photo: "/images/Commissoner.png",
        alt: "Municipal Commissioner"
    },
    {
        role: "Mayor (Mahapor)",
        name: "Shri Jayprakash Patil",
        desc: "Elected representative leading civic initiatives.",
        photo: "/images/Mayor.png",
        alt: "Mayor"
    },
    {
        role: "Deputy Mayor",
        name: "Shri Rekha Sawant",
        desc: "Supports municipal programs and ward coordination.",
        photo: "/images/Deupty_Mayor.png",
        alt: "Deputy Mayor"
    }
];

let adminIndex = 0;
const adminRole = document.getElementById("adminRole");
const adminName = document.getElementById("adminName");
const adminDesc = document.getElementById("adminDesc");
const adminPhoto = document.getElementById("adminPhoto");
const adminIndicator = document.getElementById("adminIndicator");

function renderAdminSlide(index){
    const slide = adminSlides[index];
    adminRole.textContent = slide.role;
    adminName.textContent = slide.name;
    adminDesc.textContent = slide.desc;
    adminPhoto.src = slide.photo;
    adminPhoto.alt = slide.alt;
    adminIndicator.textContent = `${index + 1} / ${adminSlides.length}`;
}

if (adminRole && adminName && adminDesc && adminPhoto && adminIndicator) {
    renderAdminSlide(adminIndex);
    setInterval(() => {
        adminIndex = (adminIndex + 1) % adminSlides.length;
        renderAdminSlide(adminIndex);
    }, 3500);
}

const toast = document.getElementById("complaintToast");
if (toast) {
    setTimeout(() => {
        toast.style.animation = "toast-out .3s ease forwards";
    }, 3000);
    setTimeout(() => {
        if (toast && toast.parentNode) {
            toast.parentNode.removeChild(toast);
        }
    }, 3400);
}
</script>

</body>
</html>
