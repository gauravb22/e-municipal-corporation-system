<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Ward Member Summary</title>

    <link rel="stylesheet" href="/css/admin-ward-report.css">
</head>
<body>
    <div class="topbar">
        <div class="brand">
            <img src="/images/municipalLogo.png" alt="Municipal Logo">
            <div>
                <div class="brand-title">Akola Mahanagarpalika</div>
                <div class="brand-sub">Ward Member Summary Report</div>
            </div>
        </div>
        <div class="topbar-actions">
            <a class="topbar-link" href="/admin/ward-reports">Back to List</a>
            <a class="topbar-link" href="/admin/ward-members">Ward Members</a>
            <a class="topbar-link" href="/admin-dashboard">Dashboard</a>
            <a class="topbar-link" href="/logout">Logout</a>
        </div>
    </div>

    <div class="container">
        <h1 class="page-title">Work Summary</h1>
        <p class="page-subtitle">
            <span th:text="${wardMember.fullName != null && !#strings.isEmpty(wardMember.fullName) ? wardMember.fullName : 'Ward Member'}">Name</span>
            <span> | </span>
            <span class="pill">Ward <span th:text="${wardMember.wardNo}">0</span> | Zone <span th:text="${wardMember.wardZone}">A</span></span>
        </p>

        <div class="card hero">
            <div class="profile">
                <div th:if="${wardMember.photoBase64 == null || #strings.isEmpty(wardMember.photoBase64)}" class="avatar-fallback">WM</div>
                <img th:if="${wardMember.photoBase64 != null && !#strings.isEmpty(wardMember.photoBase64) && #strings.startsWith(wardMember.photoBase64, 'data:')}"
                     class="avatar"
                     th:src="${wardMember.photoBase64}"
                     alt="Ward member photo" />
                <img th:if="${wardMember.photoBase64 != null && !#strings.isEmpty(wardMember.photoBase64) && !#strings.startsWith(wardMember.photoBase64, 'data:')}"
                     class="avatar"
                     th:src="${'data:image/jpeg;base64,' + wardMember.photoBase64}"
                     alt="Ward member photo" />
                <div>
                    <div class="profile-name" th:text="${wardMember.fullName != null && !#strings.isEmpty(wardMember.fullName) ? wardMember.fullName : 'Ward Member'}">Ward Member</div>
                    <div class="profile-meta">
                        Phone: <span th:text="${wardMember.phone != null && !#strings.isEmpty(wardMember.phone) ? '+91 ' + wardMember.phone : '-'}">-</span>
                    </div>
                </div>
            </div>
            <div class="actions">
                <a class="btn secondary" th:href="@{/admin/ward-reports/{id}/posts(id=${wardMember.id})}">See Work Posts</a>
                <button class="btn" type="button" onclick="printWardReport()">Print Report</button>
            </div>
        </div>

        <div class="grid">
            <div class="card">
                <div class="label">Total Complaints</div>
                <div class="value" th:text="${totalComplaints}">0</div>
            </div>
            <div class="card">
                <div class="label">Completed Works</div>
                <div class="value ok" th:text="${completedComplaints}">0</div>
            </div>
            <div class="card">
                <div class="label">Pending Works</div>
                <div class="value muted" th:text="${pendingComplaints}">0</div>
            </div>
            <div class="card">
                <div class="label">Overdue Works</div>
                <div class="value danger" th:text="${overdueComplaints}">0</div>
            </div>
            <div class="card">
                <div class="label">Completion Rate</div>
                <div class="value" th:text="${completionRate + '%'}">0%</div>
            </div>
            <div class="card">
                <div class="label">Overdue Rate</div>
                <div class="value danger" th:text="${overdueRate + '%'}">0%</div>
            </div>
            <div class="card">
                <div class="label">Avg Star Rating</div>
                <div class="value" th:text="${avgRating}">0.0</div>
            </div>
            <div class="card">
                <div class="label">Total Posts (Ward Works)</div>
                <div class="value" th:text="${totalPosts}">0</div>
            </div>
        </div>

        <div class="card">
            <div class="label">Year-wise Summary (Last 5 Years)</div>
            <div class="table-wrap">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Year</th>
                            <th>Total Complaints</th>
                            <th>Completed</th>
                            <th>Pending</th>
                            <th>Overdue</th>
                            <th>Overdue %</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="y : ${yearSummaries}">
                            <td th:text="${y.year}">2026</td>
                            <td th:text="${y.totalComplaints}">0</td>
                            <td th:text="${y.completedComplaints}">0</td>
                            <td th:text="${y.pendingComplaints}">0</td>
                            <td th:text="${y.overdueComplaints}">0</td>
                            <td th:text="${#numbers.formatDecimal(y.overdueRate, 1, 1) + '%'}">0%</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>


    <script src="/js/admin-ward-report.js"></script>
</body>
</html>

